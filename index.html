<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="cache-control" content="cache">
<meta http-equiv="pragma" content="cache">
<meta name="viewport" content="initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,width=device-width,user-scalable=no">
<meta name="robots" content="index, follow">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="preconnect" href="https://warungrim.vercel.app/">
<link rel="preconnect" href="https://semutganteng.fra1.digitaloceanspaces.com">
<style>/* Buttons */
        .btn {
            padding: 8px 16px;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            width: 50%;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .btn-orange-outline {
            background: white;
            border: 1px solid #DA6B0E;
            color: #DA6B0E;
            border-radius: 5px;
            padding: 3px 15px;
            line-height: 20px;
        }

        .btn-orange-outline:hover {
            border: 1px solid #DA6B0E;
            background: #FCF0E7;
            color: #DA6B0E;
        }

        /* Calculator Dropdown Styles */
        .dropdown-calculator-menu {
            position: relative;
        }

        .calculator-dropdown-trigger i.fa-chevron-down {
            margin-left: 5px;
            transition: transform 0.3s ease;
        }

        .dropdown-calculator-menu:hover .calculator-dropdown-trigger i.fa-chevron-down {
            transform: rotate(180deg);
        }

        .dropdown-calculator-menu:hover .calculator-dropdown-trigger,
        .dropdown-calculator-menu.active .calculator-dropdown-trigger {
            color: #fff;
        }

        .calculator-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: #FFF;
            border: none;
            border-radius: 6px;
            box-shadow: 0 16px 32px -12px rgba(14, 18, 27, 0.10);
            z-index: 1000;
            min-width: 303px;
            padding: 0;
            overflow: hidden;
        }

        .calculator-dropdown-item {
            margin-bottom: 0;
        }

        .calculator-dropdown-item:last-child {
            border-bottom: none;
        }

        .calculator-dropdown-item a {
            display: flex;
            position: relative;
            width: 303px;
            height: 50px;
            overflow: hidden;
            text-decoration: none;
            transition: transform 0.2s ease;
        }

        .calculator-dropdown-item a:hover {
            opacity: 0.9;
        }

        .calculator-dropdown-item .item-content {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            padding-left: 15px;
            z-index: 2;
        }

        .calculator-dropdown-item .item-title {
            color: #fff;
            text-shadow: none;
            font-size: 14px;
            font-weight: 600;
        }

        .calculator-dropdown-item .item-bg {
            position: absolute;
            right: 0;
            top: 0;
            width: 100%;
            height: 100%;
        }

        .calculator-dropdown-item:nth-child(1) .item-bg {
            background: linear-gradient(90deg, #1D1E20 38.1%, rgba(29, 30, 32, 0.00) 67.27%), url('https://digivospaces.b-cdn.net/UniPlay/Statics/calc-winrate-bg.png') lightgray 77.555px -102.052px / 81.902% 499.306% no-repeat !important;
            box-shadow: 0 2px 1px 0 rgba(10, 13, 20, 0.03);
        }

        .calculator-dropdown-item:nth-child(2) .item-bg {
            background: linear-gradient(90deg, #1D1E20 38.1%, rgba(29, 30, 32, 0.00) 67.27%), linear-gradient(90deg, #1F5537 38.1%, rgba(28, 72, 48, 0.00) 67.27%), url('https://digivospaces.b-cdn.net/UniPlay/Statics/calc-magic-wheel.png') lightgray 60.142px -56.844px / 100% 327.375% no-repeat !important;
            box-shadow: 0 2px 1px 0 rgba(10, 13, 20, 0.03);
        }

        .calculator-dropdown-item:nth-child(3) .item-bg {
            background: linear-gradient(90deg, #1D1E20 38.1%, rgba(29, 30, 32, 0.00) 67.27%), url('https://digivospaces.b-cdn.net/UniPlay/Statics/calc-zodiak-bg.png') lightgray 77.555px -44.052px / 75.902% 448.306% no-repeat !important;
            box-shadow: 0 2px 1px 0 rgba(10, 13, 20, 0.03);
        }

        /* Hover states for dropdown items */

        .calculator-dropdown-item:nth-child(1):hover .item-bg {
            background: linear-gradient(90deg, #49A7FF 38.1%, rgba(230, 46, 5, 0.00) 67.27%), url('https://digivospaces.b-cdn.net/UniPlay/Statics/calc-winrate-bg.png') lightgray 77.555px -102.052px / 81.902% 499.306% no-repeat !important;
        }

        .calculator-dropdown-item:nth-child(2):hover .item-bg {
            background: linear-gradient(90deg, #49A7FF 38.1%, rgba(230, 46, 5, 0.00) 67.27%), url('https://digivospaces.b-cdn.net/UniPlay/Statics/calc-magic-wheel.png') lightgray 60.142px -56.844px / 100% 327.375% no-repeat !important;
        }

        .calculator-dropdown-item:nth-child(3):hover .item-bg {
            background: linear-gradient(90deg, #49A7FF 38.1%, rgba(29, 30, 32, 0.00) 67.27%), url('https://digivospaces.b-cdn.net/UniPlay/Statics/calc-zodiak-bg.png') lightgray 77.555px -44.052px / 75.902% 448.306% no-repeat !important;
        }

        /* Hide mobile dropdown submenu on desktop */
        @media (min-width: 769px) {
            .dropdown-submenu.dropdown-calculator-mobile {
                display: none !important;
            }

            .cek-transaksi-mobile {
                display: none !important;
            }
        }

        @media (max-width: 768px) {
            .dropdown-submenu:hover .submenu {
                display: none !important;
            }

            .dropdown-submenu>a i.fa-chevron-down {
                -webkit-transition: transform 0.3s ease;
                /* Untuk iOS */
                transition: transform 0.3s ease;
            }

            .dropdown-submenu.active>a i.fa-chevron-down {
                transform: rotate(180deg);
            }

            .dropdown-submenu .submenu {
                display: none;
                list-style: none;
                padding: 0;
                margin: 0;
                background: transparent;
                margin-left: 10px;
            }

            .dropdown-submenu.active .submenu {
                display: block !important;
                background: transparent !important;
            }

            .dropdown-submenu.active {
                background: transparent !important;
            }

            .dropdown-submenu.active>a {
                background: transparent !important;
            }

            .dropdown-submenu .submenu li {
                margin: 0;
            }

            .dropdown-submenu .submenu li a {
                padding: 10px 15px;
                color: rgba(255, 255, 255, 0.8);
                font-size: 14px;
            }

            .dropdown-submenu .submenu li a:hover {
                color: #49A7FF;
                background: transparent;
            }
        }
        
        /* Custom Styles for WarungRIM */
        .warungrim-product {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .price-tag {
            color: #DA6B0E;
            font-weight: bold;
            font-size: 18px;
        }
        
        .fee-note {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .buy-button {
            background: #DA6B0E;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        
        .buy-button:hover {
            background: #c55c0d;
        }
        
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
        }
        
        .payment-modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            border-radius: 10px;
        }
        
        .admin-panel {
            display: none;
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        
        .whatsapp-notify {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #25D366;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            z-index: 1000;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        /* E-wallet specific styles */
        .ewallet-nominal {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .nominal-option {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nominal-option:hover {
            border-color: #DA6B0E;
            background: #FCF0E7;
        }
        
        .nominal-option.selected {
            border-color: #DA6B0E;
            background: #FCF0E7;
            color: #DA6B0E;
        }
        
        .nominal-amount {
            font-weight: bold;
            font-size: 16px;
        }
        
        .nominal-fee {
            font-size: 12px;
            color: #666;
        }
        
        .ewallet-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        
        .product-category-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .category-tab {
            padding: 10px 20px;
            background: #f5f5f5;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .category-tab.active {
            background: #DA6B0E;
            color: white;
        }
        
        .category-tab:hover {
            background: #e9e9e9;
        }
        
        .category-tab.active:hover {
            background: #c55c0d;
        }</style>
<meta name="google-site-verification" content="yLey4XkEvbw78fZbKBS82_htO2ePajmninBbRXbAv3Y">
<script type="text/javascript">(function(w, d, s, l, i) {
                            w[l] = w[l] || [];
                            w[l].push({
                                'gtm.start': new Date().getTime(),
                                event: 'gtm.js'
                            });
                            var f = d.getElementsByTagName(s)[0],
                                j = d.createElement(s),
                                dl = l != 'dataLayer' ? '&l=' + l : '';
                            j.async = true;
                            j.src =
                                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
                            f.parentNode.insertBefore(j, f);
                        })(window, document, 'script', 'dataLayer', 'GTM-T54MKBHW');</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K5WB3F98CK" type="text/javascript"></script>
<script type="text/javascript">window.dataLayer = window.dataLayer || [];

                        function gtag() {
                            dataLayer.push(arguments);
                        }
                        gtag('js', new Date());
                        gtag('config', 'G-K5WB3F98CK');</script>
<script type="text/javascript">! function(f, b, e, v, n, t, s) {
                            if (f.fbq) return;
                            n = f.fbq = function() {
                                n.callMethod ?
                                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
                            };
                            if (!f._fbq) f._fbq = n;
                            n.push = n;
                            n.loaded = !0;
                            n.version = '2.0';
                            n.queue = [];
                            t = b.createElement(e);
                            t.async = !0;
                            t.src = v;
                            s = b.getElementsByTagName(e)[0];
                            s.parentNode.insertBefore(t, s)
                        }(window, document, 'script',
                            'https://connect.facebook.net/en_US/fbevents.js');
                        fbq('init', '753704321022748');
                        fbq('track', 'PageView'); //is default event</script>
<script type="text/javascript">fbq('track', 'Purchase');</script>
<script type="text/javascript">fbq('track', 'AddPaymentInfo');</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=587959109024772&ev=PageView&noscript=1"></noscript>
<link rel="icon" href="https://warungrim.vercel.app/favicon.ico" sizes="32x32">
<link rel="icon" href="https://warungrim.vercel.app/favicon.ico" sizes="192x192">
<link rel="apple-touch-icon" href="https://warungrim.vercel.app/favicon.ico">
<title>WarungRIM | Top Up E-wallet & Jasa Digital</title>
<link rel="canonical" href="https://warungrim.vercel.app">
<meta name="description" content="WarungRIM: Top Up DANA, OVO, GoPay, ShopeePay, LinkAja & Repository Telegram Bot dengan harga terbaik. Biaya admin sudah termasuk.">
<meta property="og:locale" content="id_ID">
<meta property="og:type" content="website">
<meta property="og:title" content="WarungRIM | Top Up E-wallet & Jasa Digital">
<meta property="og:description" content="WarungRIM: Top Up DANA, OVO, GoPay, ShopeePay, LinkAja & Repository Telegram Bot dengan harga terbaik. Biaya admin sudah termasuk.">
<meta property="og:url" content="https://warungrim.vercel.app">
<meta property="og:site_name" content="WarungRIM">
<link rel="preload stylesheet" as="style" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap">
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="preload stylesheet" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://warungrim.vercel.app/assets/css/theme_v1.css?c=v.14.461762231854">
<script src="https://code.jquery.com/jquery-3.6.0.min.js" type="text/javascript"></script>
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" type="text/javascript"></script>
<script src="https://violetmediapay.com/assets/js/violetpay.min.js" type="text/javascript"></script>

<script type="text/javascript">
// CONFIGURATION - WARUNGRIM PRODUCTION
const CONFIG = {
    VIOLET_API_KEY: 'ub9zfg43Zrjwda6nLBSkHAoiAhJ8sDc',
    VIOLET_SECRET_KEY: 'xsCuHmyg61olqjp9a7BdAJ0z2rn8hAbktcLDPw345eviSfZL',
    VIOLET_MERCHANT_CODE: 'WARUNGRIM',
    WHATSAPP_NOTIFY: '6285923331022',
    TELEGRAM_REDIRECT: 'https://t.me/rimzohun',
    FEE_ON_CUSTOMER: true,
    FEE_PERCENTAGE: 2.5,
    ADMIN_USERNAME: 'admin',
    ADMIN_PASSWORD: 'warungrim2025'
};

// E-wallet Fee Structure
const EWALLET_FEES = {
    '10k': 1000,
    '20k': 1000,
    '25k': 1000,
    '30k': 1000,
    '35k': 2000,
    '40k': 2000,
    '45k': 2000,
    '50k': 2000,
    '60k': 3000,
    '70k': 3000,
    '75k': 3000,
    '80k': 3000,
    '90k': 3000,
    '100k': 3000,
    '150k': 5000,
    '200k': 7000,
    '250k': 9000,
    '300k': 10000,
    '500k': 15000,
    '750k': 20000,
    '1000k': 25000
};

// Products Data - 2 Kategori: Jasa Digital dan E-wallet
let products = {
    'jasa-digital': [
        {
            id: 1,
            name: "Repository Userbot VVIP Telegram",
            basePrice: 300000,
            finalPrice: 307500,
            image: "https://images.unsplash.com/photo-1611605698323-b1e99cfd37ea?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
            description: "Userbot Telegram premium dengan fitur lengkap",
            category: "Jasa Digital",
            type: "fixed"
        },
        {
            id: 2,
            name: "Repository Bot Musik Telegram",
            basePrice: 200000,
            finalPrice: 205000,
            image: "https://images.unsplash.com/photo-1511379938547-c1f69419868d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
            description: "Bot musik Telegram kualitas tinggi",
            category: "Jasa Digital",
            type: "fixed"
        },
        {
            id: 3,
            name: "SC Zhforce",
            basePrice: 30000,
            finalPrice: 30750,
            image: "https://images.unsplash.com/photo-1555066931-4365d14bab8c?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
            description: "Source code Zhforce original",
            category: "Jasa Digital",
            type: "fixed"
        }
    ],
    'ewallet': [
        {
            id: 100,
            name: "DANA",
            basePrice: 0, // Akan diisi berdasarkan nominal yang dipilih
            finalPrice: 0,
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Logo_dana_blue.svg/512px-Logo_dana_blue.svg.png",
            description: "Top Up Saldo DANA",
            category: "E-wallet",
            type: "variable",
            provider: "dana"
        },
        {
            id: 101,
            name: "OVO",
            basePrice: 0,
            finalPrice: 0,
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Logo_ovo_purple.svg/512px-Logo_ovo_purple.svg.png",
            description: "Top Up Saldo OVO",
            category: "E-wallet",
            type: "variable",
            provider: "ovo"
        },
        {
            id: 102,
            name: "GoPay",
            basePrice: 0,
            finalPrice: 0,
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/GoPay_logo.svg/512px-GoPay_logo.svg.png",
            description: "Top Up Saldo GoPay",
            category: "E-wallet",
            type: "variable",
            provider: "gopay"
        },
        {
            id: 103,
            name: "ShopeePay",
            basePrice: 0,
            finalPrice: 0,
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/ShopeePay_Logo.svg/512px-ShopeePay_Logo.svg.png",
            description: "Top Up Saldo ShopeePay",
            category: "E-wallet",
            type: "variable",
            provider: "shopeepay"
        },
        {
            id: 104,
            name: "LinkAja",
            basePrice: 0,
            finalPrice: 0,
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/LinkAja_logo.svg/512px-LinkAja_logo.svg.png",
            description: "Top Up Saldo LinkAja",
            category: "E-wallet",
            type: "variable",
            provider: "linkaja"
        }
    ]
};

// E-wallet nominal options
const EWALLET_NOMINALS = [
    { value: 10000, label: '10.000', fee: 1000 },
    { value: 20000, label: '20.000', fee: 1000 },
    { value: 25000, label: '25.000', fee: 1000 },
    { value: 30000, label: '30.000', fee: 1000 },
    { value: 35000, label: '35.000', fee: 2000 },
    { value: 40000, label: '40.000', fee: 2000 },
    { value: 45000, label: '45.000', fee: 2000 },
    { value: 50000, label: '50.000', fee: 2000 },
    { value: 60000, label: '60.000', fee: 3000 },
    { value: 70000, label: '70.000', fee: 3000 },
    { value: 75000, label: '75.000', fee: 3000 },
    { value: 80000, label: '80.000', fee: 3000 },
    { value: 90000, label: '90.000', fee: 3000 },
    { value: 100000, label: '100.000', fee: 3000 },
    { value: 150000, label: '150.000', fee: 5000 },
    { value: 200000, label: '200.000', fee: 7000 },
    { value: 250000, label: '250.000', fee: 9000 },
    { value: 300000, label: '300.000', fee: 10000 },
    { value: 500000, label: '500.000', fee: 15000 },
    { value: 750000, label: '750.000', fee: 20000 },
    { value: 1000000, label: '1.000.000', fee: 25000 }
];

// Global variables
let currentCategory = 'jasa-digital';
let selectedEwalletProduct = null;
let selectedNominal = null;

// Initialize VioletPay
function initVioletPay() {
    VioletPay.init({
        api_key: CONFIG.VIOLET_API_KEY,
        merchant_code: CONFIG.VIOLET_MERCHANT_CODE,
        environment: 'production',
        fee_on_customer: CONFIG.FEE_ON_CUSTOMER
    });
    console.log('VioletPay Production Mode Initialized');
}

// Format currency
function formatCurrency(amount) {
    return new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
        minimumFractionDigits: 0
    }).format(amount);
}

// Calculate e-wallet fee based on nominal
function calculateEwalletFee(nominal) {
    // Mencari fee berdasarkan nominal
    for (const item of EWALLET_NOMINALS) {
        if (item.value === nominal) {
            return item.fee;
        }
    }
    
    // Default fee calculation jika tidak ditemukan
    if (nominal <= 30000) return 1000;
    if (nominal <= 50000) return 2000;
    if (nominal <= 100000) return 3000;
    if (nominal <= 150000) return 5000;
    if (nominal <= 200000) return 7000;
    if (nominal <= 250000) return 9000;
    if (nominal <= 300000) return 10000;
    if (nominal <= 500000) return 15000;
    if (nominal <= 750000) return 20000;
    return 25000; // untuk 1jt ke atas
}

// Generate order ID
function generateOrderId() {
    return 'WR' + Date.now() + Math.floor(Math.random() * 1000);
}

// Create payment
async function createPayment(productId, customerData, nominal = null) {
    let product = null;
    
    // Cari produk berdasarkan kategori
    for (const category in products) {
        const found = products[category].find(p => p.id === productId);
        if (found) {
            product = found;
            break;
        }
    }
    
    if (!product) {
        alert('Produk tidak ditemukan!');
        return;
    }

    // Jika e-wallet, hitung harga berdasarkan nominal
    let finalPrice = product.finalPrice;
    let basePrice = product.basePrice;
    let feeAmount = 0;
    let productName = product.name;
    
    if (product.type === 'variable' && nominal) {
        basePrice = nominal;
        feeAmount = calculateEwalletFee(nominal);
        finalPrice = basePrice + feeAmount;
        productName = `${product.name} ${formatCurrency(nominal)}`;
        
        // Tambahkan biaya admin payment gateway (2.5%)
        const paymentGatewayFee = Math.ceil(finalPrice * (CONFIG.FEE_PERCENTAGE / 100));
        finalPrice += paymentGatewayFee;
    } else {
        // Untuk produk fixed, finalPrice sudah termasuk fee
        feeAmount = product.finalPrice - product.basePrice;
    }

    const orderId = generateOrderId();
    
    const paymentData = {
        order_id: orderId,
        amount: finalPrice,
        customer_name: customerData.name,
        customer_email: customerData.email,
        customer_phone: customerData.phone,
        product_name: productName,
        payment_method: 'ALL',
        expired_time: 24,
        fee_on_customer: CONFIG.FEE_ON_CUSTOMER,
        return_url: window.location.href,
        callback_url: window.location.origin + '/violet-callback'
    };

    try {
        const response = await VioletPay.createTransaction(paymentData);
        
        if (response.success && response.payment_url) {
            // Save order
            saveOrder(orderId, product, customerData, response, nominal, basePrice, feeAmount, finalPrice);
            
            // Send WhatsApp notification
            sendWhatsAppNotification(orderId, productName, basePrice, feeAmount, finalPrice, customerData, 'PENDING');
            
            // Redirect to payment
            window.location.href = response.payment_url;
        } else {
            alert('Gagal membuat pembayaran: ' + (response.message || 'Unknown error'));
        }
    } catch (error) {
        console.error('Payment Error:', error);
        alert('Error: ' + error.message);
    }
}

// Save order to localStorage
function saveOrder(orderId, product, customerData, violetResponse, nominal, basePrice, feeAmount, finalPrice) {
    const order = {
        orderId: orderId,
        productId: product.id,
        productName: product.name,
        nominal: nominal,
        basePrice: basePrice,
        feeAmount: feeAmount,
        finalPrice: finalPrice,
        paymentGatewayFee: finalPrice - basePrice - feeAmount,
        customer: customerData,
        status: 'PENDING',
        createdAt: new Date().toISOString(),
        violetData: violetResponse
    };

    let orders = JSON.parse(localStorage.getItem('warungrim_orders') || '[]');
    orders.push(order);
    localStorage.setItem('warungrim_orders', JSON.stringify(orders));
    localStorage.setItem('last_order_id', orderId);
}

// Send WhatsApp notification
function sendWhatsAppNotification(orderId, productName, basePrice, feeAmount, finalPrice, customerData, status) {
    let message = `ðŸ”” *PEMBAYARAN ${status}* ðŸ””

ðŸ“¦ *ORDER ID:* ${orderId}
ðŸ›’ *PRODUK:* ${productName}`;

    if (basePrice > 0) {
        message += `
ðŸ’° *NOMINAL:* ${formatCurrency(basePrice)}
ðŸ’³ *BIAYA LAYANAN:* ${formatCurrency(feeAmount)}
ðŸ’³ *BIAYA ADMIN:* ${formatCurrency(finalPrice - basePrice - feeAmount)}
ðŸ’° *TOTAL BAYAR:* ${formatCurrency(finalPrice)}`;
    } else {
        message += `
ðŸ’° *TOTAL BAYAR:* ${formatCurrency(finalPrice)}`;
    }

    message += `

ðŸ‘¤ *CUSTOMER:*
â€¢ Nama: ${customerData.name}
â€¢ Email: ${customerData.email}
â€¢ Telepon: ${customerData.phone}

â° *WAKTU:* ${new Date().toLocaleString('id-ID')}
ðŸ“Š *STATUS:* ${status}

${status === 'SUCCESS' ? 'âœ… Segera proses top up!' : 'â³ Menunggu pembayaran...'}`;

    const whatsappUrl = `https://api.whatsapp.com/send?phone=${CONFIG.WHATSAPP_NOTIFY}&text=${encodeURIComponent(message)}`;
    
    setTimeout(() => {
        window.open(whatsappUrl, '_blank');
    }, 1000);
}

// Show payment modal untuk produk fixed
function showPaymentModal(productId) {
    const product = products['jasa-digital'].find(p => p.id === productId);
    if (!product) return;
    
    document.getElementById('modalProductName').textContent = product.name;
    document.getElementById('modalBasePrice').textContent = formatCurrency(product.basePrice);
    document.getElementById('modalFee').textContent = formatCurrency(product.finalPrice - product.basePrice);
    document.getElementById('modalTotalPrice').textContent = formatCurrency(product.finalPrice);
    
    document.getElementById('paymentModal').style.display = 'block';
    document.getElementById('paymentModal').dataset.productId = productId;
    document.getElementById('paymentModal').dataset.productType = 'fixed';
    
    // Sembunyikan bagian nominal e-wallet
    document.getElementById('ewalletNominalSection').style.display = 'none';
}

// Show payment modal untuk e-wallet
function showEwalletModal(productId) {
    selectedEwalletProduct = products['ewallet'].find(p => p.id === productId);
    if (!selectedEwalletProduct) return;
    
    selectedNominal = null;
    
    document.getElementById('modalProductName').textContent = `Top Up ${selectedEwalletProduct.name}`;
    
    // Reset display
    document.getElementById('modalBasePrice').textContent = 'Pilih nominal';
    document.getElementById('modalFee').textContent = '-';
    document.getElementById('modalTotalPrice').textContent = '-';
    
    // Tampilkan bagian nominal e-wallet
    document.getElementById('ewalletNominalSection').style.display = 'block';
    
    // Generate nominal options
    const container = document.getElementById('ewalletNominalOptions');
    container.innerHTML = '';
    
    EWALLET_NOMINALS.forEach(nominal => {
        const div = document.createElement('div');
        div.className = 'nominal-option';
        div.innerHTML = `
            <div class="nominal-amount">${nominal.label}</div>
            <div class="nominal-fee">+${formatCurrency(nominal.fee)}</div>
        `;
        div.onclick = () => selectNominal(nominal, div);
        container.appendChild(div);
    });
    
    document.getElementById('paymentModal').style.display = 'block';
    document.getElementById('paymentModal').dataset.productId = productId;
    document.getElementById('paymentModal').dataset.productType = 'ewallet';
}

// Select nominal e-wallet
function selectNominal(nominal, element) {
    // Remove selected class from all options
    document.querySelectorAll('.nominal-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    
    // Add selected class to clicked option
    element.classList.add('selected');
    
    selectedNominal = nominal.value;
    
    // Calculate final price
    const feeAmount = nominal.fee;
    const basePrice = nominal.value;
    const paymentGatewayFee = Math.ceil((basePrice + feeAmount) * (CONFIG.FEE_PERCENTAGE / 100));
    const finalPrice = basePrice + feeAmount + paymentGatewayFee;
    
    // Update display
    document.getElementById('modalBasePrice').textContent = formatCurrency(basePrice);
    document.getElementById('modalFee').textContent = formatCurrency(feeAmount);
    document.getElementById('modalTotalPrice').textContent = formatCurrency(finalPrice);
}

// Close modal
function closeModal()
