<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WarungRIM | Top Up E-wallet & Jasa Digital</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* RESET & BASE STYLES */
        :root {
            --primary-color: #DA6B0E;
            --secondary-color: #FF8C00;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --dark-color: #333333;
            --light-color: #f8f9fa;
            --border-color: #e0e0e0;
            --shadow: 0 5px 15px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* HEADER */
        .header {
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 15px 0;
        }
        
        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 32px;
        }
        
        .nav {
            display: flex;
            gap: 15px;
        }
        
        .nav a {
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--dark-color);
            text-decoration: none;
        }
        
        .nav a:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: translateY(-2px);
        }
        
        /* BANNER */
        .banner {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .banner img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }
        
        /* SECTION TITLE */
        .section-title {
            text-align: center;
            margin: 40px 0 30px;
            color: var(--dark-color);
            font-size: 28px;
            font-weight: 700;
            position: relative;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 2px;
        }
        
        /* TABS */
        .tabs {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 25px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: var(--primary-color);
        }
        
        .tab-btn:hover:not(.active) {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        /* PRODUCTS GRID */
        .products-grid {
            max-width: 1200px;
            margin: 0 auto 50px;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }
        
        .product-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 2px solid var(--border-color);
            position: relative;
            cursor: pointer;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }
        
        .product-card.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .product-card.disabled:hover {
            transform: none;
            border-color: var(--border-color);
        }
        
        .stock-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--success-color);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .stock-out {
            background: var(--danger-color);
        }
        
        .product-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 15px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FCF0E7, #FFF5EB);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--primary-color);
        }
        
        .product-card h3 {
            font-size: 16px;
            margin: 10px 0;
            min-height: 50px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .product-price {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 20px;
            margin: 10px 0;
        }
        
        .product-note {
            font-size: 13px;
            color: #666;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }
        
        /* PAYMENT SECTION */
        .payment-section {
            max-width: 1200px;
            margin: 40px auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            text-align: center;
        }
        
        .payment-section h3 {
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .payment-icons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .payment-icons img {
            height: 40px;
            border-radius: 8px;
            padding: 8px;
            background: white;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        .payment-icons img:hover {
            transform: translateY(-3px);
        }
        
        /* MODAL STYLES */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-modal:hover {
            background: #f0f0f0;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        /* FORM STYLES */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(218, 107, 14, 0.1);
        }
        
        .btn-pay {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-pay:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(218, 107, 14, 0.3);
        }
        
        .btn-pay:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        /* PRICE SUMMARY */
        .price-summary {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
        }
        
        .price-row.total {
            border-top: 2px solid #ddd;
            margin-top: 8px;
            padding-top: 12px;
            font-weight: 700;
            font-size: 18px;
            color: var(--primary-color);
        }
        
        /* WHATSAPP BUTTON */
        .whatsapp-btn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 60px;
            height: 60px;
            background: #25D366;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 5px 20px rgba(37, 211, 102, 0.4);
            cursor: pointer;
            z-index: 1000;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .whatsapp-btn:hover {
            transform: scale(1.1);
        }
        
        /* FOOTER */
        .footer {
            background: #2c3e50;
            color: white;
            padding: 40px 20px;
            margin-top: 60px;
        }
        
        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }
        
        .footer-logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .footer p {
            margin: 10px 0;
            color: #ecf0f1;
        }
        
        /* PAYMENT TABS */
        .payment-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .payment-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            transition: var(--transition);
        }
        
        .payment-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .payment-tab:hover:not(.active) {
            color: var(--primary-color);
        }
        
        /* PAYMENT METHOD OPTIONS */
        .payment-methods {
            margin: 20px 0;
        }
        
        .payment-method {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .payment-method:hover {
            border-color: var(--primary-color);
        }
        
        .payment-method.selected {
            border-color: var(--primary-color);
            background: #FFF5EB;
        }
        
        .method-logo {
            width: 40px;
            height: 40px;
            margin-right: 15px;
            object-fit: contain;
        }
        
        .method-info {
            flex: 1;
            text-align: left;
        }
        
        .method-name {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .method-desc {
            font-size: 12px;
            color: #666;
        }
        
        /* LOADING */
        .loading {
            text-align: center;
            padding: 30px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 20px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .modal-content {
                margin: 10px;
            }
            
            .payment-tabs {
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .payment-section {
                padding: 20px;
                margin: 20px;
            }
        }
        
        /* ALERT MESSAGES */
        .alert {
            padding: 12px 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 14px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        /* ORDER INFO */
        .order-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .order-info h4 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .order-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        /* QR CODE DISPLAY */
        .qrcode-container {
            text-align: center;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .qrcode-img {
            width: 200px;
            height: 200px;
            margin: 15px auto;
            padding: 15px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 10px;
        }
        
        .qrcode-img img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* BANK OPTIONS */
        .bank-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .bank-option {
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .bank-option:hover {
            border-color: var(--primary-color);
        }
        
        .bank-option.selected {
            border-color: var(--primary-color);
            background: #FFF5EB;
        }
        
        .bank-logo {
            width: 40px;
            height: 40px;
            margin: 0 auto 8px;
            object-fit: contain;
        }
        
        /* E-WALLET OPTIONS */
        .ewallet-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <!-- WhatsApp Button -->
    <a href="https://wa.me/6285923331022" class="whatsapp-btn" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="#" class="logo">
                <i class="fas fa-store"></i> WarungRIM
            </a>
            <nav class="nav">
                <a href="#" onclick="showAdminPanel()">
                    <i class="fas fa-user-shield"></i> Admin
                </a>
                <a href="#contact">
                    <i class="fas fa-phone"></i> Kontak
                </a>
                <a href="#faq">
                    <i class="fas fa-question-circle"></i> FAQ
                </a>
            </nav>
        </div>
    </header>

    <!-- Banner -->
    <div class="banner">
        <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80" alt="WarungRIM">
    </div>

    <!-- Top Products -->
    <h2 class="section-title">PRODUK UNGGULAN</h2>
    <div class="products-grid" id="topProducts">
        <!-- Products will be loaded here -->
    </div>

    <!-- Category Tabs -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchCategory('jasa')">
            <i class="fas fa-code"></i> Jasa Digital
        </button>
        <button class="tab-btn" onclick="switchCategory('ewallet')">
            <i class="fas fa-wallet"></i> Top Up E-wallet
        </button>
    </div>

    <!-- Products Grid -->
    <h2 class="section-title" id="categoryTitle">JASA DIGITAL</h2>
    <div class="products-grid" id="productsGrid">
        <!-- Products will be loaded here -->
    </div>

    <!-- Payment Methods -->
    <div class="payment-section">
        <h3>
            <i class="fas fa-credit-card"></i> Metode Pembayaran
        </h3>
        <div class="payment-icons">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bank_Central_Asia.svg/512px-Bank_Central_Asia.svg.png" alt="BCA">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a0/Bank_Mandiri_logo.svg/512px-Bank_Mandiri_logo.svg.png" alt="Mandiri">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/BRI_logo.svg/512px-BRI_logo.svg.png" alt="BRI">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/BNI_logo.svg/512px-BNI_logo.svg.png" alt="BNI">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d0/QR_code_for_mobile_English_Wikipedia.svg/512px-QR_code_for_mobile_English_Wikipedia.svg.png" alt="QRIS">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/GoPay_logo.svg/512px-GoPay_logo.svg.png" alt="GoPay">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Logo_ovo_purple.svg/512px-Logo_ovo_purple.svg.png" alt="OVO">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Logo_dana_blue.svg/512px-Logo_dana_blue.svg.png" alt="DANA">
        </div>
        <p style="color: #666; margin-top: 15px; font-size: 14px;">
            <i class="fas fa-info-circle"></i> 
            Semua biaya admin sudah termasuk dalam harga
        </p>
    </div>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Checkout Produk</h3>
                <button class="close-modal" onclick="closeCheckoutModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="checkoutBody">
                <!-- Content will be loaded by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="modal-overlay" id="adminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Panel Admin WarungRIM</h3>
                <button class="close-modal" onclick="closeAdminModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="adminBody">
                <!-- Admin content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" id="contact">
        <div class="footer-container">
            <div class="footer-logo">WarungRIM</div>
            <p>Top Up E-wallet & Jasa Digital Premium</p>
            <p style="margin: 20px 0;">
                <i class="fas fa-phone"></i> 0859-2333-1022<br>
                <i class="fas fa-envelope"></i> support@warungrim.com
            </p>
            <p style="color: #bdc3c7; font-size: 14px;">
                Setelah pembayaran berhasil, Anda akan diarahkan ke WhatsApp untuk konfirmasi.<br>
                File/jasa akan dikirim setelah admin memverifikasi pembayaran.
            </p>
            <p style="margin-top: 20px; color: #95a5a6;">
                Â© 2025 WarungRIM. All rights reserved.
            </p>
        </div>
    </footer>

    <script>
        // ================= CONFIGURATION =================
        // IMPORTANT: Replace with your actual Violet Media Pay API credentials
        const CONFIG = {
            VMPAY_API_KEY: 'YOUR_API_KEY_HERE', // Get from https://violetmediapay.com
            VMPAY_SECRET_KEY: 'YOUR_SECRET_KEY_HERE', // Get from https://violetmediapay.com
            VMPAY_BASE_URL: 'https://api.violetmediapay.com/v1',
            VMPAY_WEBHOOK_URL: window.location.origin + '/vmpay-webhook',
            
            WHATSAPP_ADMIN: '6285923331022',
            FEE_PERCENTAGE: 2.5,
            
            ADMIN_USERNAME: 'admin',
            ADMIN_PASSWORD: 'warungrim2025',
            
            // Payment method codes
            PAYMENT_METHODS: {
                QRIS: 'qris',
                BCA_VA: 'bca_va',
                BRI_VA: 'bri_va',
                BNI_VA: 'bni_va',
                MANDIRI_VA: 'mandiri_va',
                GOPAY: 'gopay',
                OVO: 'ovo',
                DANA: 'dana',
                SHOPEEPAY: 'shopeepay'
            }
        };

        // ================= PRODUCTS DATA =================
        let products = {
            jasa: [
                {
                    id: 1,
                    name: "Repository Userbot VVIP Telegram",
                    basePrice: 300000,
                    image: "fas fa-robot",
                    color: "#DA6B0E",
                    description: "Userbot Telegram premium dengan 100+ fitur",
                    stock: 10,
                    isActive: true
                },
                {
                    id: 2,
                    name: "Repository Bot Musik Telegram",
                    basePrice: 200000,
                    image: "fas fa-music",
                    color: "#3498db",
                    description: "Bot musik kualitas tinggi",
                    stock: 15,
                    isActive: true
                },
                {
                    id: 3,
                    name: "SC Zhforce",
                    basePrice: 30000,
                    image: "fas fa-code",
                    color: "#2ecc71",
                    description: "Source code original",
                    stock: 20,
                    isActive: true
                },
                {
                    id: 4,
                    name: "Premium Script WhatsApp Bot",
                    basePrice: 150000,
                    image: "fab fa-whatsapp",
                    color: "#25D366",
                    description: "WhatsApp Bot dengan fitur lengkap",
                    stock: 8,
                    isActive: true
                }
            ],
            ewallet: [
                {
                    id: 101,
                    name: "DANA",
                    image: "fas fa-wallet",
                    color: "#118eea",
                    description: "Top Up Saldo DANA",
                    isActive: true,
                    type: "ewallet"
                },
                {
                    id: 102,
                    name: "OVO",
                    image: "fas fa-wallet",
                    color: "#4f2b8c",
                    description: "Top Up Saldo OVO",
                    isActive: true,
                    type: "ewallet"
                },
                {
                    id: 103,
                    name: "GoPay",
                    image: "fas fa-wallet",
                    color: "#00a64f",
                    description: "Top Up Saldo GoPay",
                    isActive: true,
                    type: "ewallet"
                },
                {
                    id: 104,
                    name: "ShopeePay",
                    image: "fas fa-wallet",
                    color: "#ff531b",
                    description: "Top Up Saldo ShopeePay",
                    isActive: true,
                    type: "ewallet"
                }
            ]
        };

        // E-wallet nominals
        const EWALLET_NOMINALS = [
            10000, 20000, 50000, 100000, 150000, 200000, 
            250000, 300000, 500000, 750000, 1000000
        ];

        // Bank list
        const BANKS = [
            { code: 'bca', name: 'BCA', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bank_Central_Asia.svg/512px-Bank_Central_Asia.svg.png' },
            { code: 'bri', name: 'BRI', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/BRI_logo.svg/512px-BRI_logo.svg.png' },
            { code: 'bni', name: 'BNI', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/BNI_logo.svg/512px-BNI_logo.svg.png' },
            { code: 'mandiri', name: 'Mandiri', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a0/Bank_Mandiri_logo.svg/512px-Bank_Mandiri_logo.svg.png' }
        ];

        // E-wallets
        const EWALLETS = [
            { code: 'gopay', name: 'GoPay', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/GoPay_logo.svg/512px-GoPay_logo.svg.png' },
            { code: 'ovo', name: 'OVO', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Logo_ovo_purple.svg/512px-Logo_ovo_purple.svg.png' },
            { code: 'dana', name: 'DANA', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Logo_dana_blue.svg/512px-Logo_dana_blue.svg.png' },
            { code: 'shopeepay', name: 'ShopeePay', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b5/ShopeePay_Logo.svg/512px-ShopeePay_Logo.svg.png' }
        ];

        // ================= GLOBAL VARIABLES =================
        let currentCategory = 'jasa';
        let currentProduct = null;
        let selectedNominal = null;
        let currentOrder = null;
        let selectedPaymentMethod = null;
        let paymentCheckInterval = null;

        // ================= HELPER FUNCTIONS =================
        function formatCurrency(amount) {
            return 'Rp ' + amount.toLocaleString('id-ID');
        }

        function generateOrderId() {
            return 'WR' + Date.now() + Math.floor(Math.random() * 1000);
        }

        function showAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = message;
            return alert;
        }

        // ================= VIOLET MEDIA PAY API =================
        async function createVMPayTransaction(orderData) {
            try {
                console.log('Creating VMPay transaction:', orderData);
                
                // In production, you would make actual API call
                // This is a mock implementation - replace with real API call
                
                const mockResponse = {
                    success: true,
                    data: {
                        transaction_id: 'vmp_' + Date.now(),
                        order_id: orderData.order_id,
                        payment_url: 'https://payment.violetmediapay.com/pay/' + generateOrderId(),
                        qr_code_url: 'https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=' + encodeURIComponent('https://payment.violetmediapay.com/pay/' + generateOrderId()),
                        va_number: '8888' + Date.now().toString().slice(-8),
                        expiry_time: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                        amount: orderData.amount,
                        status: 'pending'
                    }
                };
                
                // Real API call example (commented out for now):
                /*
                const response = await fetch(`${CONFIG.VMPAY_BASE_URL}/transaction/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.VMPAY_API_KEY}`,
                        'X-Signature': generateSignature(orderData)
                    },
                    body: JSON.stringify({
                        amount: orderData.amount,
                        customer_name: orderData.customer_name,
                        customer_email: orderData.customer_email,
                        customer_phone: orderData.customer_phone,
                        order_id: orderData.order_id,
                        payment_method: orderData.payment_method,
                        description: orderData.description,
                        callback_url: CONFIG.VMPAY_WEBHOOK_URL,
                        return_url: window.location.href
                    })
                });
                
                const data = await response.json();
                return data;
                */
                
                return mockResponse;
                
            } catch (error) {
                console.error('VMPay API Error:', error);
                throw new Error('Gagal membuat transaksi pembayaran');
            }
        }

        async function checkVMPayStatus(transactionId) {
            try {
                console.log('Checking VMPay status:', transactionId);
                
                // Mock response
                const mockResponse = {
                    success: true,
                    data: {
                        transaction_id: transactionId,
                        status: Math.random() > 0.5 ? 'paid' : 'pending', // Random status for demo
                        paid_at: new Date().toISOString(),
                        amount: currentOrder ? currentOrder.total : 0
                    }
                };
                
                // Real API call example:
                /*
                const response = await fetch(`${CONFIG.VMPAY_BASE_URL}/transaction/${transactionId}/status`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${CONFIG.VMPAY_API_KEY}`,
                        'X-Signature': generateSignature({ transaction_id: transactionId })
                    }
                });
                
                return await response.json();
                */
                
                return mockResponse;
                
            } catch (error) {
                console.error('VMPay Status Error:', error);
                throw error;
            }
        }

        function generateSignature(data) {
            // Generate HMAC SHA256 signature
            // Implementation depends on Violet Media Pay documentation
            const timestamp = Date.now();
            const message = `${CONFIG.VMPAY_API_KEY}:${timestamp}:${JSON.stringify(data)}`;
            
            // Use CryptoJS or similar library in production
            // For now, return a mock signature
            return btoa(message + CONFIG.VMPAY_SECRET_KEY);
        }

        // ================= PRODUCT DISPLAY =================
        function renderProducts() {
            // Render top products
            const topProducts = document.getElementById('topProducts');
            topProducts.innerHTML = products.jasa.filter(p => p.isActive).slice(0, 4).map(product => `
                <div class="product-card" onclick="showCheckoutModal(${product.id}, 'jasa')">
                    <span class="stock-badge ${product.stock > 0 ? '' : 'stock-out'}">
                        ${product.stock > 0 ? `Stock: ${product.stock}` : 'Habis'}
                    </span>
                    <div class="product-icon" style="background: linear-gradient(135deg, ${product.color}20, ${product.color}40); color: ${product.color};">
                        <i class="${product.image}"></i>
                    </div>
                    <h3>${product.name}</h3>
                    <div class="product-price">${formatCurrency(product.basePrice)}</div>
                    <div class="product-note">${product.description}</div>
                </div>
            `).join('');

            // Render category products
            const productsGrid = document.getElementById('productsGrid');
            const categoryProducts = products[currentCategory].filter(p => p.isActive);
            
            productsGrid.innerHTML = categoryProducts.map(product => {
                if (currentCategory === 'jasa') {
                    return `
                    <div class="product-card ${product.stock <= 0 ? 'disabled' : ''}" 
                         onclick="${product.stock <= 0 ? '' : `showCheckoutModal(${product.id}, 'jasa')`}">
                        <span class="stock-badge ${product.stock > 0 ? '' : 'stock-out'}">
                            ${product.stock > 0 ? `Stock: ${product.stock}` : 'Habis'}
                        </span>
                        <div class="product-icon" style="background: linear-gradient(135deg, ${product.color}20, ${product.color}40); color: ${product.color};">
                            <i class="${product.image}"></i>
                        </div>
                        <h3>${product.name}</h3>
                        <div class="product-price">${formatCurrency(product.basePrice)}</div>
                        <div class="product-note">${product.description}</div>
                    </div>`;
                } else {
                    return `
                    <div class="product-card" onclick="showCheckoutModal(${product.id}, 'ewallet')">
                        <span class="stock-badge">Tersedia</span>
                        <div class="product-icon" style="background: linear-gradient(135deg, ${product.color}20, ${product.color}40); color: ${product.color};">
                            <i class="${product.image}"></i>
                        </div>
                        <h3>${product.name}</h3>
                        <div class="product-price">Pilih Nominal</div>
                        <div class="product-note">${product.description}</div>
                    </div>`;
                }
            }).join('');
        }

        function switchCategory(category) {
            currentCategory = category;
            
            // Update active tab
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update title
            document.getElementById('categoryTitle').textContent = 
                category === 'jasa' ? 'JASA DIGITAL' : 'TOP UP E-WALLET';
            
            renderProducts();
        }

        // ================= CHECKOUT PROCESS =================
        function showCheckoutModal(productId, category) {
            currentProduct = products[category].find(p => p.id === productId);
            if (!currentProduct) return;
            
            // Check stock for jasa products
            if (category === 'jasa' && currentProduct.stock <= 0) {
                alert('Stok produk habis! Silakan hubungi admin untuk restock.');
                return;
            }
            
            selectedNominal = null;
            selectedPaymentMethod = null;
            
            let content = '';
            
            if (category === 'jasa') {
                const adminFee = Math.ceil(currentProduct.basePrice * (CONFIG.FEE_PERCENTAGE / 100));
                const totalPrice = currentProduct.basePrice + adminFee;
                
                content = `
                    <h4 style="text-align: center; margin-bottom: 20px;">${currentProduct.name}</h4>
                    <p style="text-align: center; color: #666; margin-bottom: 20px;">${currentProduct.description}</p>
                    
                    ${currentProduct.stock <= 3 ? `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i> Stok terbatas: ${currentProduct.stock} unit tersisa!
                        </div>
                    ` : ''}
                    
                    <div class="price-summary">
                        <div class="price-row">
                            <span>Harga Produk:</span>
                            <span>${formatCurrency(currentProduct.basePrice)}</span>
                        </div>
                        <div class="price-row">
                            <span>Biaya Admin (${CONFIG.FEE_PERCENTAGE}%):</span>
                            <span>${formatCurrency(adminFee)}</span>
                        </div>
                        <div class="price-row total">
                            <span>TOTAL BAYAR:</span>
                            <span>${formatCurrency(totalPrice)}</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Nama Lengkap</label>
                        <input type="text" id="customerName" class="form-control" placeholder="Masukkan nama lengkap" required>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-phone"></i> Nomor WhatsApp</label>
                        <input type="tel" id="customerPhone" class="form-control" placeholder="Contoh: 081234567890" required>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> Email (Opsional)</label>
                        <input type="email" id="customerEmail" class="form-control" placeholder="email@contoh.com">
                    </div>
                    
                    <button class="btn-pay" onclick="showPaymentMethods('jasa', ${currentProduct.basePrice + adminFee})">
                        <i class="fas fa-credit-card"></i> Pilih Metode Pembayaran
                    </button>
                `;
            } else {
                content = `
                    <h4 style="text-align: center; margin-bottom: 20px;">Top Up ${currentProduct.name}</h4>
                    <p style="text-align: center; color: #666; margin-bottom: 20px;">${currentProduct.description}</p>
                    
                    <div class="form-group">
                        <label><i class="fas fa-money-bill-wave"></i> Pilih Nominal</label>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            ${EWALLET_NOMINALS.map(nominal => `
                                <button onclick="selectNominal(${nominal})" 
                                        class="${selectedNominal === nominal ? 'btn-pay' : ''}" 
                                        style="padding: 12px; border: 2px solid ${selectedNominal === nominal ? '#DA6B0E' : '#e0e0e0'}; 
                                               background: ${selectedNominal === nominal ? '#FFF5EB' : 'white'}; 
                                               border-radius: 10px; cursor: pointer;">
                                    ${formatCurrency(nominal)}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    ${selectedNominal ? `
                        <div class="price-summary" id="ewalletPriceSummary" style="display: block;">
                            <div class="price-row">
                                <span>Nominal:</span>
                                <span>${formatCurrency(selectedNominal)}</span>
                            </div>
                            <div class="price-row">
                                <span>Biaya Admin (${CONFIG.FEE_PERCENTAGE}%):</span>
                                <span>${formatCurrency(Math.ceil(selectedNominal * (CONFIG.FEE_PERCENTAGE / 100)))}</span>
                            </div>
                            <div class="price-row total">
                                <span>TOTAL BAYAR:</span>
                                <span>${formatCurrency(selectedNominal + Math.ceil(selectedNominal * (CONFIG.FEE_PERCENTAGE / 100)))}</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-user"></i> Nama Lengkap</label>
                            <input type="text" id="customerName" class="form-control" placeholder="Masukkan nama lengkap" required>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-phone"></i> Nomor WhatsApp</label>
                            <input type="tel" id="customerPhone" class="form-control" placeholder="Contoh: 081234567890" required>
                        </div>
                        
                        <button class="btn-pay" onclick="showPaymentMethods('ewallet', ${selectedNominal + Math.ceil(selectedNominal * (CONFIG.FEE_PERCENTAGE / 100))})">
                            <i class="fas fa-credit-card"></i> Pilih Metode Pembayaran
                        </button>
                    ` : ''}
                `;
            }
            
            document.getElementById('checkoutBody').innerHTML = content;
            document.getElementById('checkoutModal').style.display = 'flex';
        }

        function selectNominal(nominal) {
            selectedNominal = nominal;
            showCheckoutModal(currentProduct.id, 'ewallet');
        }

        function showPaymentMethods(productType, totalAmount) {
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const customerEmail = document.getElementById('customerEmail') ? document.getElementById('customerEmail').value : '';
            
            if (!customerName || !customerPhone) {
                alert('Harap isi nama dan nomor WhatsApp!');
                return;
            }
            
            // Save order data
            currentOrder = {
                id: generateOrderId(),
                productId: currentProduct.id,
                productName: currentProduct.name,
                productType: productType,
                customer: {
                    name: customerName,
                    phone: customerPhone,
                    email: customerEmail
                },
                total: totalAmount,
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            // Save to localStorage
            saveOrder(currentOrder);
            
            // Show payment methods
            const content = `
                <h4 style="text-align: center; margin-bottom: 20px;">Pilih Metode Pembayaran</h4>
                <div class="order-info">
                    <h4>Detail Pesanan</h4>
                    <p><strong>Order ID:</strong> ${currentOrder.id}</p>
                    <p><strong>Produk:</strong> ${currentProduct.name} ${selectedNominal ? formatCurrency(selectedNominal) : ''}</p>
                    <p><strong>Total:</strong> ${formatCurrency(totalAmount)}</p>
                </div>
                
                <div class="payment-tabs">
                    <button class="payment-tab active" onclick="showPaymentTab('qris')">QRIS</button>
                    <button class="payment-tab" onclick="showPaymentTab('va')">Virtual Account</button>
                    <button class="payment-tab" onclick="showPaymentTab('ewallet')">E-Wallet</button>
                </div>
                
                <div id="paymentTabContent">
                    <!-- Tab content will be loaded here -->
                </div>
                
                <button class="btn-pay" onclick="backToCheckout()" style="background: #6c757d; margin-top: 20px;">
                    <i class="fas fa-arrow-left"></i> Kembali
                </button>
            `;
            
            document.getElementById('checkoutBody').innerHTML = content;
            showPaymentTab('qris');
        }

        function showPaymentTab(tab) {
            // Update active tab
            document.querySelectorAll('.payment-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            let content = '';
            
            switch(tab) {
                case 'qris':
                    content = `
                        <div class="payment-methods">
                            <div class="payment-method selected" onclick="processPayment('qris')">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d0/QR_code_for_mobile_English_Wikipedia.svg/512px-QR_code_for_mobile_English_Wikipedia.svg.png" 
                                     alt="QRIS" class="method-logo">
                                <div class="method-info">
                                    <div class="method-name">QRIS</div>
                                    <div class="method-desc">Scan QR Code dengan aplikasi bank/e-wallet</div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'va':
                    content = `
                        <div class="bank-options">
                            ${BANKS.map(bank => `
                                <div class="bank-option" onclick="selectBank('${bank.code}')">
                                    <img src="${bank.logo}" alt="${bank.name}" class="bank-logo">
                                    <div>${bank.name}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div id="bankDetails" style="display: none; margin-top: 20px;">
                            <!-- Bank details will be shown here -->
                        </div>
                    `;
                    break;
                    
                case 'ewallet':
                    content = `
                        <div class="ewallet-options">
                            ${EWALLETS.map(ewallet => `
                                <div class="payment-method" onclick="selectEwallet('${ewallet.code}')">
                                    <img src="${ewallet.logo}" alt="${ewallet.name}" class="method-logo">
                                    <div class="method-info">
                                        <div class="method-name">${ewallet.name}</div>
                                        <div class="method-desc">Bayar dengan ${ewallet.name}</div>
                                    </div>
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            `).join('')}
                        </div>
                        <div id="ewalletDetails" style="display: none; margin-top: 20px;">
                            <!-- E-wallet details will be shown here -->
                        </div>
                    `;
                    break;
            }
            
            document.getElementById('paymentTabContent').innerHTML = content;
        }

        async function processPayment(method) {
            selectedPaymentMethod = method;
            
            // Prepare payment data for Violet Media Pay
            const paymentData = {
                order_id: currentOrder.id,
                amount: currentOrder.total,
                customer_name: currentOrder.customer.name,
                customer_email: currentOrder.customer.email || '',
                customer_phone: currentOrder.customer.phone,
                payment_method: getPaymentMethodCode(method),
                description: `Pembayaran untuk ${currentProduct.name}`
            };
            
            try {
                // Show loading
                document.getElementById('checkoutBody').innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Memproses pembayaran...</p>
                    </div>
                `;
                
                // Create Violet Media Pay transaction
                const result = await createVMPayTransaction(paymentData);
                
                if (result.success) {
                    const transaction = result.data;
                    
                    // Update order with transaction ID
                    currentOrder.transactionId = transaction.transaction_id;
                    currentOrder.paymentMethod = method;
                    updateOrder(currentOrder);
                    
                    // Show payment instructions
                    showPaymentInstructions(transaction);
                    
                    // Start checking payment status
                    startPaymentStatusCheck(transaction.transaction_id);
                    
                } else {
                    throw new Error(result.message || 'Gagal membuat transaksi');
                }
                
            } catch (error) {
                document.getElementById('checkoutBody').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-times-circle"></i> ${error.message}
                    </div>
                    <button class="btn-pay" onclick="showPaymentMethods()">
                        <i class="fas fa-arrow-left"></i> Kembali ke Pilihan Pembayaran
                    </button>
                `;
            }
        }

        function selectBank(bankCode) {
            const bank = BANKS.find(b => b.code === bankCode);
            document.getElementById('bankDetails').innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Virtual Account ${bank.name} akan dibuat setelah Anda melanjutkan
                </div>
                <button class="btn-pay" onclick="processPayment('${bankCode}_va')">
                    <i class="fas fa-credit-card"></i> Buat Virtual Account ${bank.name}
                </button>
            `;
            document.getElementById('bankDetails').style.display = 'block';
        }

        function selectEwallet(ewalletCode) {
            const ewallet = EWALLETS.find(e => e.code === ewalletCode);
            document.getElementById('ewalletDetails').innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Pembayaran ${ewallet.name} akan diproses setelah Anda melanjutkan
                </div>
                <button class="btn-pay" onclick="processPayment('${ewalletCode}')">
                    <i class="fas fa-credit-card"></i> Bayar dengan ${ewallet.name}
                </button>
            `;
            document.getElementById('ewalletDetails').style.display = 'block';
        }

        function getPaymentMethodCode(method) {
            const mapping = {
                'qris': 'QRIS',
                'bca_va': 'BCA',
                'bri_va': 'BRI',
                'bni_va': 'BNI',
                'mandiri_va': 'MANDIRI',
                'gopay': 'GOPAY',
                'ovo': 'OVO',
                'dana': 'DANA',
                'shopeepay': 'SHOPEEPAY'
            };
            return mapping[method] || method;
        }

        function showPaymentInstructions(transaction) {
            let instructions = '';
            
            if (selectedPaymentMethod === 'qris') {
                instructions = `
                    <h4 style="text-align: center; margin-bottom: 20px;">QRIS Payment</h4>
                    <div class="qrcode-container">
                        <div class="qrcode-img">
                            <img src="${transaction.qr_code_url}" alt="QR Code">
                        </div>
                        <p><strong>Order ID:</strong> ${currentOrder.id}</p>
                        <p><strong>Total:</strong> ${formatCurrency(currentOrder.total)}</p>
                        <p>Scan QR Code di atas dengan aplikasi bank atau e-wallet Anda</p>
                    </div>
                `;
            } else if (selectedPaymentMethod.includes('_va')) {
                const bankName = selectedPaymentMethod.replace('_va', '').toUpperCase();
                instructions = `
                    <h4 style="text-align: center; margin-bottom: 20px;">Virtual Account ${bankName}</h4>
                    <div class="order-info">
                        <p><strong>Nomor VA:</strong> <span style="font-size: 20px; font-weight: bold;">${transaction.va_number}</span></p>
                        <p><strong>Bank:</strong> ${bankName}</p>
                        <p><strong>Total:</strong> ${formatCurrency(currentOrder.total)}</p>
                        <p><strong>Batas Waktu:</strong> ${new Date(transaction.expiry_time).toLocaleString('id-ID')}</p>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Transfer ke Virtual Account di atas sebelum batas waktu
                    </div>
                `;
            } else {
                const ewalletName = selectedPaymentMethod.toUpperCase();
                instructions = `
                    <h4 style="text-align: center; margin-bottom: 20px;">${ewalletName} Payment</h4>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Anda akan diarahkan ke halaman pembayaran ${ewalletName}
                    </div>
                    <button class="btn-pay" onclick="window.open('${transaction.payment_url}', '_blank')">
                        <i class="fas fa-external-link-alt"></i> Lanjutkan ke ${ewalletName}
                    </button>
                `;
            }
            
            instructions += `
                <div id="paymentStatus" style="margin-top: 20px;"></div>
                <button class="btn-pay" onclick="checkPaymentStatusNow()" style="background: #28a745; margin-top: 10px;">
                    <i class="fas fa-sync-alt"></i> Cek Status Pembayaran
                </button>
                <div class="alert alert-warning" style="margin-top: 20px;">
                    <i class="fas fa-clock"></i> Status pembayaran akan diperiksa otomatis setiap 30 detik
                </div>
            `;
            
            document.getElementById('checkoutBody').innerHTML = instructions;
        }

        function startPaymentStatusCheck(transactionId) {
            // Clear existing interval
            if (paymentCheckInterval) {
                clearInterval(paymentCheckInterval);
            }
            
            // Check immediately
            checkPaymentStatusNow();
            
            // Check every 30 seconds
            paymentCheckInterval = setInterval(checkPaymentStatusNow, 30000);
        }

        async function checkPaymentStatusNow() {
            if (!currentOrder || !currentOrder.transactionId) return;
            
            try {
                const statusDiv = document.getElementById('paymentStatus');
                if (statusDiv) {
                    statusDiv.innerHTML = `
                        <div class="alert alert-info">
                            <i class="fas fa-sync-alt fa-spin"></i> Memeriksa status pembayaran...
                        </div>
                    `;
                }
                
                const result = await checkVMPayStatus(currentOrder.transactionId);
                
                if (result.success) {
                    const status = result.data.status;
                    
                    if (status === 'paid') {
                        // Payment successful
                        clearInterval(paymentCheckInterval);
                        
                        // Update order status
                        currentOrder.status = 'paid';
                        currentOrder.paidAt = new Date().toISOString();
                        updateOrder(currentOrder);
                        
                        // Reduce stock for jasa products
                        if (currentProduct.type === 'jasa') {
                            const product = products.jasa.find(p => p.id === currentProduct.id);
                            if (product && product.stock > 0) {
                                product.stock -= 1;
                                saveProducts();
                                renderProducts();
                            }
                        }
                        
                        // Show success message
                        if (statusDiv) {
                            statusDiv.innerHTML = `
                                <div class="alert alert-success">
                                    <i class="fas fa-check-circle"></i> 
                                    <strong>Pembayaran Berhasil!</strong><br>
                                    Anda akan diarahkan ke WhatsApp dalam 5 detik...
                                </div>
                            `;
                        }
                        
                        // Redirect to WhatsApp after 5 seconds
                        setTimeout(() => {
                            redirectToWhatsApp();
                        }, 5000);
                        
                    } else if (status === 'failed' || status === 'expired') {
                        // Payment failed
                        clearInterval(paymentCheckInterval);
                        
                        if (statusDiv) {
                            statusDiv.innerHTML = `
                                <div class="alert alert-danger">
                                    <i class="fas fa-times-circle"></i> 
                                    Pembayaran gagal atau kadaluarsa
                                </div>
                            `;
                        }
                        
                    } else {
                        // Still pending
                        if (statusDiv) {
                            statusDiv.innerHTML = `
                                <div class="alert alert-warning">
                                    <i class="fas fa-clock"></i> 
                                    Menunggu pembayaran...
                                </div>
                            `;
                        }
                    }
                }
                
            } catch (error) {
                console.error('Status check error:', error);
                const statusDiv = document.getElementById('paymentStatus');
                if (statusDiv) {
                    statusDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i> 
                            Gagal memeriksa status pembayaran
                        </div>
                    `;
                }
            }
        }

        function redirectToWhatsApp() {
            const message = `Halo Admin WarungRIM,

Saya sudah melakukan pembayaran dengan detail:

Order ID: ${currentOrder.id}
Produk: ${currentProduct.name} ${selectedNominal ? formatCurrency(selectedNominal) : ''}
Total: ${formatCurrency(currentOrder.total)}
Metode: ${selectedPaymentMethod ? selectedPaymentMethod.toUpperCase() : '-'}
Nama: ${currentOrder.customer.name}
Email: ${currentOrder.customer.email || '-'}
No. HP: ${currentOrder.customer.phone}

Mohon untuk segera diproses. Terima kasih.`;

            const whatsappUrl = `https://wa.me/${CONFIG.WHATSAPP_ADMIN}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            closeCheckoutModal();
        }

        function backToCheckout() {
            showCheckoutModal(currentProduct.id, currentProduct.type || 'jasa');
        }

        function closeCheckoutModal() {
            // Clear payment check interval
            if (paymentCheckInterval) {
                clearInterval(paymentCheckInterval);
                paymentCheckInterval = null;
            }
            
            document.getElementById('checkoutModal').style.display = 'none';
            currentProduct = null;
            selectedNominal = null;
            selectedPaymentMethod = null;
        }

        // ================= ADMIN FUNCTIONS =================
        function showAdminPanel() {
            const content = `
                <h4 style="text-align: center; margin-bottom: 30px;">Login Admin</h4>
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="adminUsername" class="form-control" value="${CONFIG.ADMIN_USERNAME}">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="adminPassword" class="form-control" value="${CONFIG.ADMIN_PASSWORD}">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-key"></i> Violet Media Pay API Key</label>
                    <input type="text" id="vmpayApiKey" class="form-control" placeholder="Masukkan API Key" value="${CONFIG.VMPAY_API_KEY}">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-key"></i> Violet Media Pay Secret Key</label>
                    <input type="password" id="vmpaySecretKey" class="form-control" placeholder="Masukkan Secret Key" value="${CONFIG.VMPAY_SECRET_KEY}">
                </div>
                <button class="btn-pay" onclick="loginAdmin()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            `;
            
            document.getElementById('adminBody').innerHTML = content;
            document.getElementById('adminModal').style.display = 'flex';
        }

        function loginAdmin() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            const apiKey = document.getElementById('vmpayApiKey').value;
            const secretKey = document.getElementById('vmpaySecretKey').value;
            
            if (username === CONFIG.ADMIN_USERNAME && password === CONFIG.ADMIN_PASSWORD) {
                // Save API credentials
                if (apiKey && secretKey) {
                    CONFIG.VMPAY_API_KEY = apiKey;
                    CONFIG.VMPAY_SECRET_KEY = secretKey;
                    localStorage.setItem('vmpay_api_key', apiKey);
                    localStorage.setItem('vmpay_secret_key', secretKey);
                }
                
                showAdminDashboard();
            } else {
                alert('Username atau password salah!');
            }
        }

        function showAdminDashboard() {
            const orders = getOrders();
            const totalOrders = orders.length;
            const totalRevenue = orders.reduce((sum, order) => sum + (order.status === 'paid' ? order.total : 0), 0);
            const todayOrders = orders.filter(order => 
                new Date(order.createdAt).toDateString() === new Date().toDateString()
            ).length;
            
            const content = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h4>Dashboard Admin</h4>
                    <button onclick="logoutAdmin()" style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div style="background: #28a745; color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <h5>Total Transaksi</h5>
                        <h3>${totalOrders}</h3>
                    </div>
                    <div style="background: #007bff; color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <h5>Total Pendapatan</h5>
                        <h3>${formatCurrency(totalRevenue)}</h3>
                    </div>
                    <div style="background: #ffc107; color: #333; padding: 20px; border-radius: 10px; text-align: center;">
                        <h5>Hari Ini</h5>
                        <h3>${todayOrders}</h3>
                    </div>
                </div>
                
                <h5 style="margin-bottom: 15px;">Transaksi Terbaru</h5>
                <div style="max-height: 300px; overflow-y: auto;">
                    ${orders.slice(-10).reverse().map(order => `
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid ${order.status === 'paid' ? '#28a745' : order.status === 'failed' ? '#dc3545' : '#ffc107'}">
                            <div style="display: flex; justify-content: space-between;">
                                <div>
                                    <strong>${order.id}</strong><br>
                                    <small>${order.productName}</small>
                                </div>
                                <div style="text-align: right;">
                                    <span style="color: ${order.status === 'paid' ? '#28a745' : order.status === 'failed' ? '#dc3545' : '#ffc107'}; font-weight: bold;">
                                        ${order.status === 'paid' ? 'â Lunas' : order.status === 'failed' ? 'â Gagal' : 'â³ Pending'}
                                    </span><br>
                                    <small>${formatCurrency(order.total)}</small>
                                </div>
                            </div>
                            <div style="margin-top: 8px; font-size: 12px; color: #666;">
                                <i class="fas fa-user"></i> ${order.customer.name} â¢ 
                                <i class="fas fa-credit-card"></i> ${order.paymentMethod || '-'} â¢ 
                                <i class="fas fa-clock"></i> ${new Date(order.createdAt).toLocaleString('id-ID')}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="margin-top: 20px;">
                    <button onclick="exportOrders()" style="background: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                    <button onclick="resetSystem()" style="background: #dc3545; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-trash"></i> Reset System
                    </button>
                </div>
            `;
            
            document.getElementById('adminBody').innerHTML = content;
        }

        function logoutAdmin() {
            document.getElementById('adminModal').style.display = 'none';
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
        }

        function exportOrders() {
            const orders = getOrders();
            const dataStr = JSON.stringify(orders, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `warungrim_orders_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function resetSystem() {
            if (confirm('Apakah Anda yakin ingin mereset sistem? Semua data akan dihapus!')) {
                localStorage.removeItem('warungrim_orders');
                localStorage.removeItem('warungrim_products');
                localStorage.removeItem('vmpay_api_key');
                localStorage.removeItem('vmpay_secret_key');
                alert('Sistem telah direset!');
                window.location.reload();
            }
        }

        // ================= STORAGE FUNCTIONS =================
        function saveOrder(order) {
            const orders = getOrders();
            orders.push(order);
            localStorage.setItem('warungrim_orders', JSON.stringify(orders));
        }

        function updateOrder(updatedOrder) {
            const orders = getOrders();
            const index = orders.findIndex(o => o.id === updatedOrder.id);
            if (index !== -1) {
                orders[index] = updatedOrder;
                localStorage.setItem('warungrim_orders', JSON.stringify(orders));
            }
        }

        function getOrders() {
            const saved = localStorage.getItem('warungrim_orders');
            return saved ? JSON.parse(saved) : [];
        }

        function saveProducts() {
            localStorage.setItem('warungrim_products', JSON.stringify(products));
        }

        function loadProducts() {
            const saved = localStorage.getItem('warungrim_products');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    // Merge with default products
                    products.jasa.forEach((product, index) => {
                        if (parsed.jasa && parsed.jasa[index]) {
                            product.stock = parsed.jasa[index].stock || product.stock;
                            product.isActive = parsed.jasa[index].isActive !== undefined ? parsed.jasa[index].isActive : true;
                        }
                    });
                } catch (e) {
                    console.error('Error loading products:', e);
                }
            }
        }

        function loadApiCredentials() {
            const apiKey = localStorage.getItem('vmpay_api_key');
            const secretKey = localStorage.getItem('vmpay_secret_key');
            
            if (apiKey && secretKey) {
                CONFIG.VMPAY_API_KEY = apiKey;
                CONFIG.VMPAY_SECRET_KEY = secretKey;
            }
        }

        // ================= INITIALIZATION =================
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved data
            loadProducts();
            loadApiCredentials();
            
            // Initial render
            renderProducts();
            
            // Setup modal close
            document.getElementById('checkoutModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCheckoutModal();
                }
            });
            
            document.getElementById('adminModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAdminModal();
                }
            });
            
            // Update WhatsApp button
            document.querySelector('.whatsapp-btn').href = `https://wa.me/${CONFIG.WHATSAPP_ADMIN}`;
        });
    </script>
</body>
    </html>
